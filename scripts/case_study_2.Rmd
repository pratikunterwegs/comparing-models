---
editor_options: 
  chunk_output_type: console
---

# Run models for case study 2

```{r}
# load packages
library(data.table)
library(ggplot2)
```

## Demonstrate landscape

```{r}
# patchy landscape
l = ecoevomove2::get_test_landscape(
    nItems = 450,
    landsize = 30,
    nClusters = 30,
    clusterSpread = 0.5,
    regen_time = 100
)

ggplot(l)+
    geom_point(
        aes(
            x, y
        )
    )
```

## Random walk movement

### Random walk on patchy landscapes

```{r}
# run scenarios
data_random <- lapply(seq(20), function(x) {
  ecoevomove2::model_case_2(
    scenario = 0,
    landsize = 30,
    nItems = 450,
    clusterSpread = 0.5,
    nClusters = 30,
    regen_time = 100,
    tmax = 400,
    handling_time = 5,
    popsize = 200,
    genmax = 1,
    dispersal = 10,
    range_perception = 0.5,
    mProb = 0.01,
    mSize = 0.01,
    nThreads = 1
  )
})
```

```{r}
# examine intake in random movement
data_random_intake = lapply(data_random, slot, "trait_data")

# assign replicate
data_random_intake = Map(
    data_random_intake, seq(length(data_random_intake)),
    f = function(df, n) {
        setDT(df)
        df[, replicate := as.factor(n)][]
    }
)

data_random_intake = rbindlist(data_random_intake)

# add details
data_random_intake[, landscape := "patchy"]
data_random_intake[, type := "random"]

# save trait data
fwrite(
    data_random_intake,
    file = "inst/data/data_traits_random_patchy.csv"
)
```

Networks from random walk on patchy landscape.

```{r}
networks_random = lapply(data_random, make_network, weight_threshold = 3)

# save networks
saveRDS(networks_random, file = "inst/data/networks_random_patchy.Rds")
```

### Random walks, homogeneous resource landscapes

```{r}
# run scenarios
data_random <- lapply(seq(20), function(x) {
  ecoevomove2::model_case_2(
    scenario = 0,
    landsize = 30,
    nItems = 450,
    clusterSpread = 0.5,
    nClusters = 90,
    regen_time = 100,
    tmax = 400,
    handling_time = 5,
    popsize = 200,
    genmax = 1,
    dispersal = 10,
    range_perception = 0.5,
    mProb = 0.01,
    mSize = 0.01,
    nThreads = 1
  )
})
```

```{r}
# examine intake in random movement
data_random_intake = lapply(data_random, slot, "trait_data")

# assign replicate
data_random_intake = Map(
    data_random_intake, seq(length(data_random_intake)),
    f = function(df, n) {
        setDT(df)
        df[, replicate := as.factor(n)][]
    }
)

data_random_intake = rbindlist(data_random_intake)

# add details
data_random_intake[, landscape := "homog"]
data_random_intake[, type := "random"]

# save trait data
fwrite(
    data_random_intake,
    file = "inst/data/data_traits_random_homog.csv"
)
```

Networks from random walk on homogeneous landscape.

```{r}
networks_random = lapply(data_random, make_network, weight_threshold = 3)

# save networks
saveRDS(networks_random, file = "inst/data/networks_random_homog.Rds")
```

## Optimal movement

### Optimal movement, patchy resource landscapes

```{r}
# run scenarios
data_optimal <- lapply(seq(20), function(x) {
  ecoevomove2::model_case_2(
    scenario = 0,
    landsize = 30,
    nItems = 450,
    clusterSpread = 0.5,
    nClusters = 30,
    regen_time = 100,
    tmax = 400,
    handling_time = 5,
    popsize = 200,
    genmax = 1,
    dispersal = 10,
    range_perception = 0.5,
    mProb = 0.01,
    mSize = 0.01,
    nThreads = 1
  )
})
```

```{r}
# examine intake in optimal movement
data_optimal_intake = lapply(data_optimal, slot, "trait_data")

# assign replicate
data_optimal_intake = Map(
    data_optimal_intake, seq(length(data_optimal_intake)),
    f = function(df, n) {
        setDT(df)
        df[, replicate := as.factor(n)][]
    }
)

data_optimal_intake = rbindlist(data_optimal_intake)

# add details
data_optimal_intake[, landscape := "patchy"]
data_optimal_intake[, type := "optimal"]

# save trait data
fwrite(
    data_optimal_intake,
    file = "inst/data/data_traits_optimal_patchy.csv"
)
```

Networks from optimal movement strategies on patchy landscapes.

```{r}
networks_optimal = lapply(data_optimal, make_network, weight_threshold = 3)

# save networks
saveRDS(networks_optimal, file = "inst/data/networks_optimal_patchy.Rds")
```

### Optimal movement, homogeneous resource landscapes

```{r}
# run scenarios
data_optimal <- lapply(seq(20), function(x) {
  ecoevomove2::model_case_2(
    scenario = 0,
    landsize = 30,
    nItems = 450,
    clusterSpread = 0.5,
    nClusters = 90,
    regen_time = 100,
    tmax = 400,
    handling_time = 5,
    popsize = 200,
    genmax = 1,
    dispersal = 10,
    range_perception = 0.5,
    mProb = 0.01,
    mSize = 0.01,
    nThreads = 1
  )
})
```

```{r}
# examine intake in optimal movement
data_optimal_intake = lapply(data_optimal, slot, "trait_data")

# assign replicate
data_optimal_intake = Map(
    data_optimal_intake, seq(length(data_optimal_intake)),
    f = function(df, n) {
        setDT(df)
        df[, replicate := as.factor(n)][]
    }
)

data_optimal_intake = rbindlist(data_optimal_intake)

# add details
data_optimal_intake[, landscape := "homog"]
data_optimal_intake[, type := "optimal"]

# save trait data
fwrite(
    data_optimal_intake,
    file = "inst/data/data_traits_optimal_homog.csv"
)
```

Networks from optimal movement strategies on homogeneous landscapes.

```{r}
networks_optimal = lapply(data_optimal, make_network, weight_threshold = 3)

# save networks
saveRDS(networks_optimal, file = "inst/data/networks_optimal_homog.Rds")
```

## Evolved movement strategies

### Evolved strategies, patchy resource landscapes

```{r}
# run scenarios
data_evolved <- lapply(seq(20), function(x) {
  ecoevomove2::model_case_2(
    scenario = 2,
    landsize = 30,
    nItems = 450,
    clusterSpread = 0.5,
    nClusters = 30,
    regen_time = 100,
    tmax = 400,
    handling_time = 5,
    popsize = 200,
    genmax = 100,
    dispersal = 2,
    range_perception = 1,
    mProb = 0.01,
    mSize = 0.01,
    nThreads = 2
  )
})
```

```{r}
# examine intake in evolved movement
data_evolved_intake = lapply(data_evolved, slot, "trait_data")

# assign replicate
data_evolved_intake = Map(
    data_evolved_intake, seq(length(data_evolved_intake)),
    f = function(df, n) {
        setDT(df)
        df[, replicate := as.factor(n)][]
    }
)

data_evolved_intake = rbindlist(data_evolved_intake)
data_evolved_intake = get_social_strategy(data_evolved_intake)

# add details
data_evolved_intake[, landscape := "patchy"]
data_evolved_intake[, type := "evolved"]

# save trait data
fwrite(
    data_evolved_intake,
    file = "inst/data/data_traits_evolved_patchy.csv"
)
```

Networks from evolved movement strategies on patchy landscapes.

```{r}
networks_evolved = lapply(data_evolved, make_network, weight_threshold = 3)

# save networks
saveRDS(networks_evolved, file = "inst/data/networks_evolved_patchy.Rds")
```

### Evolved strategies, homogeneous resource landscapes

```{r}
# run scenarios
data_evolved <- lapply(seq(20), function(x) {
  ecoevomove2::model_case_2(
    scenario = 2,
    landsize = 30,
    nItems = 450,
    clusterSpread = 0.5,
    nClusters = 90,
    regen_time = 100,
    tmax = 400,
    handling_time = 5,
    popsize = 200,
    genmax = 100,
    dispersal = 2,
    range_perception = 1,
    mProb = 0.01,
    mSize = 0.01,
    nThreads = 2
  )
})
```

```{r}
# examine intake in evolved movement
data_evolved_intake = lapply(data_evolved, slot, "trait_data")

# assign replicate
data_evolved_intake = Map(
    data_evolved_intake, seq(length(data_evolved_intake)),
    f = function(df, n) {
        setDT(df)
        df[, replicate := as.factor(n)][]
    }
)

data_evolved_intake = rbindlist(data_evolved_intake)
data_evolved_intake = get_social_strategy(data_evolved_intake)

# add details
data_evolved_intake[, landscape := "homog"]
data_evolved_intake[, type := "evolved"]

# save trait data
fwrite(
    data_evolved_intake,
    file = "inst/data/data_traits_evolved_homog.csv"
)
```

Networks from evolved movement strategies on homog landscapes.

```{r}
networks_evolved = lapply(data_evolved, make_network, weight_threshold = 3)

# save networks
saveRDS(networks_evolved, file = "inst/data/networks_evolved_homog.Rds")
```
